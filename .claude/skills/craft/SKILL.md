---
name: craft
description: "Craft something new. Smart flow adapts to your situation: existing project, from scratch, with inspiration. Reactive agents collaborate intelligently."
context: conversation
allowed-tools: Read, Bash, Task, AskUserQuestion, Glob, Grep, WebFetch
---

# Spectre Craft â€” Smart Reactive Flow

Intelligent flow that adapts to your situation AND your input.

---

## The Smart Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  /craft                                                          â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  1. PROJECT DETECTION               â”‚                        â”‚
â”‚  â”‚     Existing code? Stack?           â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                â”‚                                                 â”‚
â”‚                â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  2. WORK CONTEXT                    â”‚                        â”‚
â”‚  â”‚     Product / Startup / Freelance   â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                â”‚                                                 â”‚
â”‚                â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  3. WHAT TO BUILD?                  â”‚                        â”‚
â”‚  â”‚     User describes feature/idea     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                â”‚                                                 â”‚
â”‚                â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  4. INPUT ANALYSIS â† NEW!           â”‚                        â”‚
â”‚  â”‚     Detect input type & route       â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                â”‚                                                 â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚       â”‚        â”‚        â”‚          â”‚                            â”‚
â”‚       â–¼        â–¼        â–¼          â–¼                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”                          â”‚
â”‚    â”‚ Ideaâ”‚  â”‚Func â”‚  â”‚Tech â”‚  â”‚Bug/ â”‚                          â”‚
â”‚    â”‚ raw â”‚  â”‚Spec â”‚  â”‚Spec â”‚  â”‚Fix  â”‚                          â”‚
â”‚    â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜                          â”‚
â”‚       â”‚        â”‚        â”‚        â”‚                              â”‚
â”‚       â–¼        â–¼        â–¼        â–¼                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”                          â”‚
â”‚    â”‚ PO  â”‚  â”‚Archiâ”‚  â”‚ Dev â”‚  â”‚ Dev â”‚                          â”‚
â”‚    â”‚firstâ”‚  â”‚firstâ”‚  â”‚firstâ”‚  â”‚only â”‚                          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                  â”‚
â”‚                â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  5. REACTIVE PARALLEL EXECUTION     â”‚                        â”‚
â”‚  â”‚     Agents work & collaborate       â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 1: Project Detection

```bash
# Check for existing project
if [ -f "package.json" ] || [ -f "go.mod" ] || [ -f "Cargo.toml" ]; then
  FROM_SCRATCH=false
  # â†’ Auto-detect stack, trigger /learn
else
  FROM_SCRATCH=true
  # â†’ Ask for stack
fi
```

### If From Scratch â†’ Ask Stack

```
Question: "What stack?"
Header: "Stack"
Options:
  1. "TypeScript + React" - Frontend with Vite
  2. "TypeScript + Node" - Backend API
  3. "Full-stack TypeScript" - React + Node
  4. "Go" - Backend with Go
```

---

## Step 2: Work Context

```
Question: "What's your work context?"
Header: "Context"
Options:
  1. "Product Team" - Full process: PO â†’ Architect â†’ Dev â†’ QA
  2. "Startup" - Fast: Architect â†’ Dev â†’ QA
  3. "Freelance" - Efficient: Dev â†’ QA
  4. "Learning" - Educational: Single agent explains
```

---

## Step 3: What to Build

```
Question: "What do you want to build?"
Header: "Feature"
# Free text input - user describes their idea/feature/spec
```

---

## Step 4: Input Analysis (THE SMART PART)

Analyze what the user provided to determine routing:

### Input Types

| Type | Indicators | Example | Route |
|------|------------|---------|-------|
| **Raw Idea** | Vague, no acceptance criteria, informal | "a sexy counter" | PO first |
| **Functional Spec** | User stories, acceptance criteria, behavior described | "Counter that increments, persists in localStorage, has dark mode" | Architect first |
| **Technical Spec** | Architecture details, file structure, implementation notes | "Create Counter.tsx with useState, useEffect for localStorage sync" | Dev first |
| **Bug/Fix** | References existing code, describes problem | "Fix the counter reset bug in Counter.tsx" | Dev only |

### Detection Logic

```
ANALYZE the user's input:

IF input is vague/informal (just an idea, no specifics):
  â†’ INPUT_TYPE = "raw_idea"
  â†’ NEEDS_PO = true
  â†’ "User has an idea but no spec. PO will formalize it."

ELSE IF input has functional requirements (what, not how):
  â†’ INPUT_TYPE = "functional_spec"
  â†’ NEEDS_PO = false
  â†’ "User has functional spec. Architect can design."

ELSE IF input has technical details (how, structure, files):
  â†’ INPUT_TYPE = "technical_spec"
  â†’ NEEDS_PO = false
  â†’ NEEDS_ARCHITECT = false
  â†’ "User has technical spec. Dev can implement."

ELSE IF input references existing code/bug:
  â†’ INPUT_TYPE = "fix"
  â†’ NEEDS_PO = false
  â†’ NEEDS_ARCHITECT = false
  â†’ "Bug fix. Dev handles, QA verifies."
```

### Inform the User

```
Based on your input, here's the plan:

ğŸ“ Input type: Raw idea
ğŸ¯ Flow: PO â†’ Architect â†’ Dev â‡„ QA

The Product Owner will first create a proper spec from your idea,
then the Architect will design the technical solution.

[Start] [I have more details to add]
```

---

## Step 5: Smart Routing by Input Type

### Route A: Raw Idea â†’ PO First

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER INPUT: "a sexy counter"                                    â”‚
â”‚                                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚       â”‚    PO    â”‚ â† Creates functional spec                    â”‚
â”‚       â”‚  (spec)  â”‚                                              â”‚
â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚            â”‚ user story + acceptance criteria                   â”‚
â”‚            â–¼                                                     â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚       â”‚ Architectâ”‚ â† Creates technical design                   â”‚
â”‚       â”‚ (design) â”‚                                              â”‚
â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚            â”‚ architecture + file structure                      â”‚
â”‚            â–¼                                                     â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚       â”‚      PARALLEL           â”‚                               â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚                               â”‚
â”‚       â”‚  â”‚ Dev  â”‚  â”‚  QA  â”‚    â”‚                               â”‚
â”‚       â”‚  â”‚impl  â”‚â‡„â”‚tests â”‚    â”‚                               â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜    â”‚                               â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**PO Output:**
```markdown
## User Story
As a user, I want a visually appealing counter
so that I can track a value with delight.

## Acceptance Criteria
- [ ] Counter displays current value (starts at 0)
- [ ] Increment button (+1) with satisfying animation
- [ ] Decrement button (-1) with animation
- [ ] Reset button
- [ ] Value persists across page refresh
- [ ] Dark/light mode toggle
- [ ] Micro-interactions on hover/click
- [ ] Accessible (keyboard nav, screen reader)

## Edge Cases
- Negative values allowed? â†’ Ask user or default to yes
- Max value? â†’ No limit unless specified
```

### Route B: Functional Spec â†’ Architect First

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER INPUT: "Counter with +/-, localStorage, dark mode"        â”‚
â”‚                                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚       â”‚ Architectâ”‚ â† Designs from functional spec               â”‚
â”‚       â”‚ (design) â”‚                                              â”‚
â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚            â”‚                                                     â”‚
â”‚            â–¼                                                     â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚       â”‚      PARALLEL           â”‚                               â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚                               â”‚
â”‚       â”‚  â”‚ Dev  â”‚  â”‚  QA  â”‚    â”‚                               â”‚
â”‚       â”‚  â”‚impl  â”‚â‡„â”‚tests â”‚    â”‚                               â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜    â”‚                               â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Route C: Technical Spec â†’ Dev First

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER INPUT: "Create Counter.tsx with useState, Tailwind..."    â”‚
â”‚                                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚       â”‚      PARALLEL           â”‚                               â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚                               â”‚
â”‚       â”‚  â”‚ Dev  â”‚  â”‚  QA  â”‚    â”‚                               â”‚
â”‚       â”‚  â”‚impl  â”‚â‡„â”‚tests â”‚    â”‚                               â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜    â”‚                               â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Route D: Bug Fix â†’ Dev Only

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER INPUT: "Fix the counter not persisting on refresh"        â”‚
â”‚                                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚       â”‚ Dev  â”‚ â”€â”€â”€â–¶ â”‚  QA  â”‚                                    â”‚
â”‚       â”‚ fix  â”‚      â”‚verifyâ”‚                                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Parallel Execution: Dev â‡„ QA

The magic: **Dev and QA work in parallel**, not sequentially.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PARALLEL REACTIVE LOOP                         â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                          â”‚  â”‚
â”‚   â”‚    Dev implements          QA writes tests              â”‚  â”‚
â”‚   â”‚         â”‚                        â”‚                       â”‚  â”‚
â”‚   â”‚         â”‚   â† shares context â†’   â”‚                       â”‚  â”‚
â”‚   â”‚         â”‚                        â”‚                       â”‚  â”‚
â”‚   â”‚         â–¼                        â–¼                       â”‚  â”‚
â”‚   â”‚    Code ready              Tests ready                   â”‚  â”‚
â”‚   â”‚         â”‚                        â”‚                       â”‚  â”‚
â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚   â”‚                  â”‚                                       â”‚  â”‚
â”‚   â”‚                  â–¼                                       â”‚  â”‚
â”‚   â”‚            QA runs tests                                 â”‚  â”‚
â”‚   â”‚                  â”‚                                       â”‚  â”‚
â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                               â”‚  â”‚
â”‚   â”‚         â”‚               â”‚                               â”‚  â”‚
â”‚   â”‚        PASS            FAIL                              â”‚  â”‚
â”‚   â”‚         â”‚               â”‚                               â”‚  â”‚
â”‚   â”‚         â–¼               â–¼                               â”‚  â”‚
â”‚   â”‚       Done         Dev fixes                            â”‚  â”‚
â”‚   â”‚                        â”‚                                â”‚  â”‚
â”‚   â”‚                        â””â”€â”€â”€â”€â”€â”€â–¶ QA re-runs              â”‚  â”‚
â”‚   â”‚                                                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### How Parallel Works

1. **Architect** outputs design with:
   - File structure
   - Component specs
   - Acceptance criteria (for QA)

2. **Dev starts** implementing from the design

3. **QA starts** writing tests from acceptance criteria
   - Doesn't wait for Dev to finish
   - Writes test shells based on expected behavior

4. **When Dev completes a component**, QA runs its tests

5. **If tests fail**, Dev gets immediate feedback and fixes

6. **Loop continues** until all tests pass

---

## Agent Prompts

### PO Prompt (Raw Idea â†’ Spec)

```
Task(
  subagent_type: "product-owner",
  prompt: """
    USER'S IDEA: <raw idea>
    STACK: <detected or chosen stack>

    ## Your Job

    Transform this raw idea into a proper functional specification.

    ## Output Format

    ### User Story
    As a [user type], I want [feature]
    so that [benefit].

    ### Acceptance Criteria
    - [ ] Criterion 1 (specific, testable)
    - [ ] Criterion 2
    - [ ] ...

    ### Edge Cases
    - What happens if...?
    - What about...?

    ### Out of Scope (for this iteration)
    - Things to explicitly NOT do now

    ### Questions for User (if any)
    - Clarifications needed before proceeding

    ## Rules
    - Be specific and testable
    - Think about edge cases
    - Consider accessibility
    - Keep scope reasonable for first iteration
  """
)
```

### Architect Prompt (Spec â†’ Design)

```
Task(
  subagent_type: "architect",
  prompt: """
    ## CONTEXT

    FUNCTIONAL SPEC:
    <PO's output or user's functional spec>

    STACK: <stack>
    CRAFT PRINCIPLES: Result<T,E>, strict TypeScript, hexagonal

    ## Your Job

    Design the technical architecture.

    ## Output Format

    ### Architecture Decision
    Brief explanation of approach.

    ### File Structure
    ```
    src/
    â”œâ”€â”€ features/
    â”‚   â””â”€â”€ <feature>/
    â”‚       â”œâ”€â”€ domain/       # Entities, value objects
    â”‚       â”œâ”€â”€ application/  # Use cases, hooks
    â”‚       â”œâ”€â”€ infrastructure/ # API, storage
    â”‚       â””â”€â”€ ui/           # Components
    ```

    ### Key Files to Create
    1. File path - purpose
    2. ...

    ### For Dev
    Implementation notes, patterns to use.

    ### For QA (Acceptance Test Specs)
    Test scenarios derived from acceptance criteria:
    - Test: "should increment counter"
    - Test: "should persist value to localStorage"
    - ...

    ### Implementation Phases
    1. Phase 1: ...
    2. Phase 2: ...
  """
)
```

### Parallel Dev + QA Spawn

```
# Launch BOTH in parallel
Task(
  subagent_type: "frontend-engineer",
  run_in_background: true,
  prompt: """
    ARCHITECT DESIGN: <design>

    Implement the feature following the design.
    Write to .spectre/dev-progress.md as you complete each file.
  """
)

Task(
  subagent_type: "qa-engineer",
  run_in_background: true,
  prompt: """
    ACCEPTANCE CRITERIA: <from PO or architect>
    TEST SPECS: <from architect>

    Write tests for this feature.
    - Unit tests for domain logic
    - Integration tests for use cases
    - Component tests for UI

    Watch .spectre/dev-progress.md for completed files.
    Run tests as files become available.
    Write failures to .spectre/test-failures.md
  """
)

# Orchestrator monitors both and routes failures
```

---

## Context-Aware Routing Matrix

| Context | Input Type | Pipeline |
|---------|------------|----------|
| **Product Team** | Raw idea | PO â†’ Architect â†’ Dev // QA |
| **Product Team** | Func spec | Architect â†’ Dev // QA |
| **Product Team** | Tech spec | Dev // QA |
| **Startup** | Raw idea | PO (light) â†’ Architect â†’ Dev // QA |
| **Startup** | Func spec | Architect â†’ Dev // QA |
| **Startup** | Tech spec | Dev // QA |
| **Freelance** | Any | Dev â†’ QA |
| **Learning** | Any | Single agent (explains as it goes) |

---

## Example: Full Flow

```
User: /craft

ğŸ” No existing project detected.

"What stack?"
[ TypeScript + React ]

"What's your work context?"
[ Startup ]

"What do you want to build?"

User: a sexy counter

ğŸ“ Analyzing your input...

   Input type: Raw idea (informal, no specifics)
   Recommended flow: PO â†’ Architect â†’ Dev â‡„ QA

   The Product Owner will create a proper spec first.

[ Start ] [ Add more details ]

User: [ Start ]

ğŸ‘¤ Product Owner creating spec...

   ## User Story
   As a user, I want a visually appealing counter
   so that I can track values with delight.

   ## Acceptance Criteria
   - [ ] Display current value (default: 0)
   - [ ] Increment (+1) with micro-animation
   - [ ] Decrement (-1) with micro-animation
   - [ ] Reset to 0
   - [ ] Persist in localStorage
   - [ ] Dark/light theme toggle
   - [ ] Keyboard accessible (arrows, enter)
   - [ ] Smooth transitions

   ## Edge Cases
   - Allow negative values
   - No max limit

[ Approve spec ] [ Modify ]

User: [ Approve spec ]

ğŸ—ï¸ Architect designing...

   ## Architecture

   src/features/counter/
   â”œâ”€â”€ domain/
   â”‚   â””â”€â”€ Counter.ts         # Value + operations
   â”œâ”€â”€ application/
   â”‚   â””â”€â”€ useCounter.ts      # Hook with localStorage
   â”œâ”€â”€ infrastructure/
   â”‚   â””â”€â”€ CounterStorage.ts  # localStorage adapter
   â””â”€â”€ ui/
       â”œâ”€â”€ Counter.tsx        # Main component
       â”œâ”€â”€ Counter.test.tsx   # Tests
       â””â”€â”€ CounterButton.tsx  # Animated button

   ## For QA - Test Scenarios
   - renders with initial value 0
   - increments on + click
   - decrements on - click
   - resets to 0
   - persists to localStorage
   - loads from localStorage on mount
   - supports keyboard navigation

[ Approve design ] [ Modify ]

User: [ Approve design ]

ğŸš€ Starting parallel execution...

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ğŸ’» Dev implementing...                  â”‚
   â”‚  ğŸ§ª QA writing tests...                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Dev: âœ“ Created Counter.ts (domain)
   QA:  âœ“ Writing domain tests...

   Dev: âœ“ Created useCounter.ts
   QA:  âœ“ Writing hook tests...

   Dev: âœ“ Created Counter.tsx
   QA:  ğŸ§ª Running tests...

   QA:  âŒ FAIL: "should persist to localStorage"
        Expected localStorage.setItem to be called

   Dev: ğŸ”§ Fixing... added localStorage sync

   QA:  ğŸ§ª Re-running...
   QA:  âœ“ All tests passing (12/12)

âœ¨ Feature complete!

   Files: 6 created
   Tests: 12 passing
   Coverage: 94%
```

---

## State Storage

```json
// .spectre/state.json
{
  "workflow": "craft",
  "inputType": "raw_idea",
  "context": "startup",
  "phase": "parallel_execution",
  "agents": {
    "po": { "status": "complete", "output": "spec.md" },
    "architect": { "status": "complete", "output": "design.md" },
    "dev": { "status": "in_progress", "files": ["Counter.ts", "useCounter.ts"] },
    "qa": { "status": "in_progress", "tests": 12, "passing": 10, "failing": 2 }
  }
}
```

---

## Tone

- **Smart**: Detects input type, routes intelligently
- **Parallel**: Dev and QA work together, not sequentially
- **Reactive**: Failures route instantly to the right agent
- **Transparent**: User sees what's happening at each step
- **Adaptive**: Different flows for different contexts
